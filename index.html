<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map — Pine City Zoo</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* ── Index-only styles ── */
    .welcome-banner {
      background: linear-gradient(135deg, var(--green-deep) 0%, var(--green-mid) 60%, var(--green-light) 100%);
      border-radius: var(--radius-lg);
      padding: 36px 28px 32px;
      color: #fff;
      text-align: center;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }
    .welcome-banner::before {
      content: '';
      position: absolute;
      top: -60px; right: -60px;
      width: 220px; height: 220px;
      background: rgba(255,255,255,.07);
      border-radius: 50%;
    }
    .welcome-banner::after {
      content: '';
      position: absolute;
      bottom: -40px; left: -40px;
      width: 160px; height: 160px;
      background: rgba(255,255,255,.05);
      border-radius: 50%;
    }
    .welcome-banner h1 {
      font-family: 'Playfair Display', serif;
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }
    .welcome-banner p {
      font-size: 15px;
      opacity: .85;
      font-weight: 300;
      position: relative;
      z-index: 1;
    }

    /* Stats */
    .map-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    .map-stat {
      background: var(--surface);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-md);
      padding: 18px 10px;
      text-align: center;
      box-shadow: var(--shadow-sm);
      transition: transform var(--transition), box-shadow var(--transition);
    }
    .map-stat:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
    .map-stat-num {
      font-family: 'Playfair Display', serif;
      font-size: 30px;
      font-weight: 700;
      color: var(--green-mid);
      line-height: 1;
    }
    .map-stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
      letter-spacing: .4px;
      text-transform: uppercase;
      font-weight: 600;
    }

    /* Quick Actions */
    .quick-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    .quick-action-btn {
      flex: 1;
      min-width: 130px;
      padding: 12px 14px;
      background: var(--surface);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-md);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all var(--transition);
      box-shadow: var(--shadow-sm);
    }
    .quick-action-btn i { color: var(--green-mid); font-size: 16px; }
    .quick-action-btn:hover {
      background: var(--green-deep);
      border-color: var(--green-deep);
      color: #fff;
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }
    .quick-action-btn:hover i { color: #fff; }

    /* Map card */
    #map-container {
      background: var(--surface);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      overflow: hidden;
      max-width: 960px;
      margin: 0 auto;
    }

    /* Toolbar */
    .map-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 11px 16px;
      border-bottom: 1px solid var(--border);
      background: var(--stone-pale);
    }
    .dark-mode .map-toolbar { background: rgba(111,170,94,.06); }
    .map-toolbar-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
    }
    .map-toolbar-title i { color: var(--green-mid); }

    .btn-fullscreen {
      display: flex;
      align-items: center;
      gap: 7px;
      padding: 7px 15px;
      background: var(--green-deep);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      font-family: 'DM Sans', sans-serif;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      letter-spacing: .4px;
      transition: background var(--transition), transform var(--transition);
    }
    .btn-fullscreen:hover { background: var(--green-mid); transform: translateY(-1px); }
    .btn-fullscreen i { font-size: 13px; }

    .map-canvas-wrap { position: relative; width: 100%; }
    #interactive-map { width: 100%; height: auto; display: block; cursor: pointer; }

    .map-legend {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      padding: 12px 20px;
      border-top: 1px solid var(--border);
      background: var(--stone-pale);
    }
    .dark-mode .map-legend { background: rgba(111,170,94,.06); }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    .legend-dot {
      width: 13px; height: 13px;
      border-radius: 50%;
      flex-shrink: 0;
      border: 2px solid rgba(255,255,255,.7);
    }
    .legend-dot.animal { background: var(--accent-gold); }
    .legend-dot.place  { background: #2176ae; }

    .map-hint {
      text-align: center;
      font-size: 12px;
      color: var(--text-muted);
      padding: 10px 16px;
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .map-hint i { color: var(--green-light); }

    /* ══════════════════════════════════════
       FULLSCREEN OVERLAY
    ══════════════════════════════════════ */
    #map-fullscreen-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9000;
      background: #0d1a0b;
      flex-direction: column;
    }
    #map-fullscreen-overlay.open {
      display: flex;
      animation: fsIn .2s ease;
    }
    @keyframes fsIn {
      from { opacity: 0; transform: scale(.98); }
      to   { opacity: 1; transform: scale(1); }
    }

    /* FS Header */
    .fs-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 20px;
      background: var(--green-deep);
      flex-shrink: 0;
    }
    .fs-header-title {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #fff;
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 600;
    }
    .fs-header-title i { opacity: .75; font-size: 15px; }

    .btn-close-fs {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(255,255,255,.15);
      color: #fff;
      border: 1px solid rgba(255,255,255,.25);
      border-radius: var(--radius-sm);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: background var(--transition);
    }
    .btn-close-fs:hover { background: rgba(255,255,255,.28); }

    /* FS Canvas area */
    .fs-canvas-wrap {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
      overflow: hidden;
    }
    #interactive-map-fs {
      max-width: 100%;
      max-height: 100%;
      display: block;
      border-radius: var(--radius-md);
      cursor: pointer;
      box-shadow: 0 0 80px rgba(0,0,0,.6);
    }

    /* FS Footer */
    .fs-footer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 24px;
      padding: 11px 20px;
      background: rgba(0,0,0,.45);
      flex-shrink: 0;
      flex-wrap: wrap;
    }
    .fs-legend-item {
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 13px;
      color: rgba(255,255,255,.7);
    }
    .fs-dot {
      width: 12px; height: 12px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,.4);
    }
    .fs-dot.animal { background: var(--accent-gold); }
    .fs-dot.place  { background: #4da3e8; }
    .fs-hint {
      font-size: 12px;
      color: rgba(255,255,255,.4);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .fs-esc {
      display: inline-block;
      background: rgba(255,255,255,.1);
      padding: 1px 6px;
      border-radius: 4px;
      font-size: 11px;
      font-family: monospace;
    }

    @media (max-width: 480px) {
      .welcome-banner h1 { font-size: 22px; }
      .map-stat-num { font-size: 24px; }
      .quick-action-btn { font-size: 12px; padding: 10px; }
      .fs-header-title { font-size: 14px; }
      .fs-hint { display: none; }
    }
  </style>
</head>
<body>

  <div id="header">
    <img src="images/logo.png" alt="Pine City Zoo"/>
  </div>

  <nav id="tabs-top">
    <a href="animals.html"><i class="fa-solid fa-paw"></i> <span>Animals</span></a>
    <a href="index.html" class="active"><i class="fa-solid fa-map"></i> <span>Map</span></a>
    <a href="places.html"><i class="fa-solid fa-location-dot"></i> <span>Places</span></a>
  </nav>

  <div id="main">
    <div id="content">

      <!-- Search -->
      <div id="search-container">
        <div class="search-wrapper">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input type="text" id="search-input" placeholder="Search animals or attractions…">
        </div>
        <div id="search-results"></div>
      </div>

      <!-- Welcome Banner -->
      <div class="welcome-banner">
        <h1>Welcome to Pine City Zoo</h1>
        <p>Explore our interactive map to discover animals and attractions</p>
      </div>

      <!-- Stats -->
      <div class="map-stats">
        <div class="map-stat">
          <div class="map-stat-num">15+</div>
          <div class="map-stat-label">Animals</div>
        </div>
        <div class="map-stat">
          <div class="map-stat-num">8</div>
          <div class="map-stat-label">Attractions</div>
        </div>
        <div class="map-stat">
          <div class="map-stat-num">5</div>
          <div class="map-stat-label">Dining Spots</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <a href="planner.html" class="quick-action-btn">
          <i class="fa-solid fa-route"></i> Plan Your Visit
        </a>
        <a href="weather.html" class="quick-action-btn">
          <i class="fa-solid fa-sun"></i> Check Weather
        </a>
        <a href="feedback.html" class="quick-action-btn">
          <i class="fa-solid fa-comment-dots"></i> Send Feedback
        </a>
      </div>

      <!-- Map Card -->
      <div id="map-container">

        <div class="map-toolbar">
          <div class="map-toolbar-title">
            <i class="fa-solid fa-map-location-dot"></i>
            Interactive Zoo Map
          </div>
          <button class="btn-fullscreen" onclick="openFullscreen()">
            <i class="fa-solid fa-expand"></i> Full Screen
          </button>
        </div>

        <div class="map-canvas-wrap">
          <canvas id="interactive-map"></canvas>
        </div>

        <div class="map-legend">
          <div class="legend-item"><span class="legend-dot animal"></span> Animals</div>
          <div class="legend-item"><span class="legend-dot place"></span> Places &amp; Attractions</div>
        </div>

        <div class="map-hint">
          <i class="fa-solid fa-hand-pointer"></i>
          Hover over markers to preview — click to explore
        </div>

      </div>

    </div>
  </div>

  <!-- ══ FULLSCREEN OVERLAY ══ -->
  <div id="map-fullscreen-overlay">

    <div class="fs-header">
      <div class="fs-header-title">
        <i class="fa-solid fa-map-location-dot"></i>
        Pine City Zoo — Interactive Map
      </div>
      <button class="btn-close-fs" onclick="closeFullscreen()">
        <i class="fa-solid fa-compress"></i> Exit Full Screen
      </button>
    </div>

    <div class="fs-canvas-wrap" id="fs-canvas-wrap">
      <canvas id="interactive-map-fs"></canvas>
    </div>

    <div class="fs-footer">
      <div class="fs-legend-item"><span class="fs-dot animal"></span> Animals</div>
      <div class="fs-legend-item"><span class="fs-dot place"></span> Places &amp; Attractions</div>
      <div class="fs-hint">
        <i class="fa-solid fa-hand-pointer"></i> Click a marker to navigate &nbsp;·&nbsp;
        <span class="fs-esc">Esc</span> to exit
      </div>
    </div>

  </div>

  <div id="dark-mode-toggle-container">
    <label class="switch">
      <input type="checkbox" id="dark-mode-toggle">
      <span class="slider"></span>
    </label>
  </div>

  <nav id="tabs-bottom">
    <a href="weather.html"><i class="fa-solid fa-sun"></i> <span>Weather</span></a>
    <a href="feedback.html"><i class="fa-solid fa-comment-dots"></i> <span>Feedback</span></a>
  </nav>

  <script src="data.js"></script>
  <script src="script.js"></script>
  <script>
    const overlay  = document.getElementById('map-fullscreen-overlay');
    const fsCanvas = document.getElementById('interactive-map-fs');
    const fsWrap   = document.getElementById('fs-canvas-wrap');

    /* ── Open fullscreen ── */
    function openFullscreen() {
      overlay.classList.add('open');
      document.body.style.overflow = 'hidden';

      const el = overlay;
      if      (el.requestFullscreen)       el.requestFullscreen().catch(() => {});
      else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if (el.mozRequestFullScreen)    el.mozRequestFullScreen();

      // Two rAF frames: first lets overlay display:flex render,
      // second lets browser calculate real clientWidth/Height
      requestAnimationFrame(() => requestAnimationFrame(() => {
        sizeAndDrawFs();
      }));
    }

    /* ── Close fullscreen ── */
    function closeFullscreen() {
      overlay.classList.remove('open');
      document.body.style.overflow = '';
      document.getElementById('map-tooltip').style.display = 'none';

      if      (document.exitFullscreen)       document.exitFullscreen().catch(() => {});
      else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      else if (document.mozCancelFullScreen)  document.mozCancelFullScreen();
    }

    /* ── Size canvas and draw — fills the full screen ── */
    function sizeAndDrawFs() {
      // Use window dimensions — reliable in both native fullscreen and overlay mode
      const totalH  = window.innerHeight;
      const headerH = overlay.querySelector('.fs-header').offsetHeight || 56;
      const footerH = overlay.querySelector('.fs-footer').offsetHeight || 46;
      const availW  = window.innerWidth  - 64;  // 32px gap each side
      const availH  = totalH - headerH - footerH - 64;

      // Keep 1000:600 aspect ratio
      const ratio = 1000 / 600;
      let w = availW;
      let h = w / ratio;
      if (h > availH) { h = availH; w = h * ratio; }
      w = Math.round(w);
      h = Math.round(h);

      // Internal canvas resolution scales up for sharp rendering on big screens
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      fsCanvas.width  = w * dpr;
      fsCanvas.height = h * dpr;
      fsCanvas.style.width  = w + 'px';
      fsCanvas.style.height = h + 'px';

      // Draw at the higher resolution
      const ctx = fsCanvas.getContext('2d');
      ctx.setTransform(dpr * (w / 1000), 0, 0, dpr * (h / 600), 0, 0);
      drawBeautifulMap(ctx);
      drawAllIcons(ctx);

      // Wire up interactions — .onclick assignment safely replaces old handler
      const tooltip = document.getElementById('map-tooltip');

      fsCanvas.onclick = function(e) {
        const rect   = fsCanvas.getBoundingClientRect();
        // Map CSS px back to the 1000x600 logical coordinate space
        const mx = (e.clientX - rect.left) * (1000 / rect.width);
        const my = (e.clientY - rect.top)  * (600  / rect.height);
        for (const loc of getAllLocations()) {
          const dx = mx - loc.coords.x;
          const dy = my - loc.coords.y;
          if (Math.sqrt(dx*dx + dy*dy) < 40) { window.location.href = loc.page; return; }
        }
      };

      fsCanvas.onmousemove = function(e) {
        const rect   = fsCanvas.getBoundingClientRect();
        const mx = (e.clientX - rect.left) * (1000 / rect.width);
        const my = (e.clientY - rect.top)  * (600  / rect.height);
        let found = false;
        for (const loc of getAllLocations()) {
          const dx = mx - loc.coords.x;
          const dy = my - loc.coords.y;
          if (Math.sqrt(dx*dx + dy*dy) < 40) {
            const isAnim = zooData.animals.includes(loc);
            tooltip.innerHTML =
              '<strong style="font-size:14px;display:block;margin-bottom:3px;">' + loc.name + '</strong>' +
              '<span style="font-size:11px;color:#a8d89a;text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:4px;">' + (isAnim ? 'Animal' : 'Attraction') + '</span>' +
              '<span style="font-size:12px;color:rgba(255,255,255,.75);">' + loc.description + '</span>';
            // Smart positioning — stays inside viewport
            const tx = Math.min(e.clientX + 16, window.innerWidth  - 220);
            const ty = Math.max(e.clientY - 90,  10);
            tooltip.style.left    = tx + 'px';
            tooltip.style.top     = ty + 'px';
            tooltip.style.display = 'block';
            fsCanvas.style.cursor = 'pointer';
            found = true; break;
          }
        }
        if (!found) { tooltip.style.display = 'none'; fsCanvas.style.cursor = 'default'; }
      };

      fsCanvas.onmouseleave = () => { tooltip.style.display = 'none'; };

      fsCanvas.ontouchend = function(e) {
        e.preventDefault();
        const touch  = e.changedTouches[0];
        const rect   = fsCanvas.getBoundingClientRect();
        const scaleX = 1000 / rect.width;
        const scaleY = 600  / rect.height;
        const mx = (touch.clientX - rect.left) * scaleX;
        const my = (touch.clientY - rect.top)  * scaleY;
        for (const loc of getAllLocations()) {
          const dx = mx - loc.coords.x;
          const dy = my - loc.coords.y;
          if (Math.sqrt(dx*dx + dy*dy) < 48) { window.location.href = loc.page; return; }
        }
      };
    }

    /* ── Keyboard: Escape to close ── */
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape' && overlay.classList.contains('open')) {
        closeFullscreen();
      }
    });

    /* ── Native fullscreen ended (e.g. user pressed F11 or browser button) ── */
    document.addEventListener('fullscreenchange',       syncFsState);
    document.addEventListener('webkitfullscreenchange', syncFsState);
    document.addEventListener('mozfullscreenchange',    syncFsState);
    function syncFsState() {
      const active = document.fullscreenElement || document.webkitFullscreenElement;
      if (!active && overlay.classList.contains('open')) {
        overlay.classList.remove('open');
        document.body.style.overflow = '';
      }
    }

    /* ── Resize: redraw if overlay open ── */
    window.addEventListener('resize', () => {
      if (overlay.classList.contains('open')) sizeAndDrawFs();
    });
  </script>
</body>
</html>